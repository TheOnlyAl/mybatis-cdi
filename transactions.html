<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 18 January 2014 
 | Rendered using Apache Maven Fluido Skin 1.3.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Frank Martinez" />
    <meta name="author" content="Eduardo Macarron" />
    <meta name="Date-Revision-yyyymmdd" content="20140118" />
    <meta http-equiv="Content-Language" content="en" />
    <title>MyBatis - 
    MyBatis-CDI | Transactions</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.1.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.1.min.js"></script>

    
                  </head>
        <body class="topBarDisabled">
          
        
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>MyBatis CDI Extension</h2>
                </div>
                      </div>
        <div class="pull-right">                  <a href="http://www.mybatis.org/" id="bannerRight" title="MyBatis logo">
                                                                                        <img src="http://mybatis.github.io/images/mybatis-logo.png"  alt="MyBatis logo"/>
                </a>
      </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 18 January 2014
                      <span class="divider">|</span>
                   </li>
                  <li id="projectVersion">Version: 1.0-SNAPSHOT
                      </li>
                      
                
                    
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Reference Documentation</li>
                              
      <li>
  
                          <a href="index.html" title="Introduction">
          <i class="none"></i>
        Introduction</a>
            </li>
                
      <li>
  
                          <a href="getting-started.html" title="Getting Started">
          <i class="none"></i>
        Getting Started</a>
            </li>
                
      <li>
  
                          <a href="injection.html" title="Injecting beans">
          <i class="none"></i>
        Injecting beans</a>
            </li>
                
      <li class="active">
  
            <a href="#"><i class="none"></i>Transactions</a>
          </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                                                                                                                        
      <li>
  
                          <a href="project-info.html" title="Project Information">
          <i class="icon-chevron-right"></i>
        Project Information</a>
                  </li>
                                                                                                                                                                                                                                    
      <li>
  
                          <a href="project-reports.html" title="Project Reports">
          <i class="icon-chevron-right"></i>
        Project Reports</a>
                  </li>
            </ul>
                
                    
                
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <!-- Copyright 2013 the original author or authors.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License. --><!-- version: $Id$ -->

  
    <div class="section">
<h2>Transactions<a name="Transactions"></a></h2>
      
<p>
        As you may have expected, MyBatis-CDI provides annotation based transaction support.
      </p>
           
      
<p>
        By default, each method call will use an isolated session but if you want to enclose many method calls in a transaction, 
        annotate the method with <tt>@Transactional</tt>.
      </p>
      
        
<div class="source">
<pre>@Transactional
public void doSomethingInATransaction() {
  ...
  mapper.insertMyBean(...);
  mapper.updateMyBean(...);
  ...  
}</pre></div>

      
<p><span class="label important">NOTE</span>
        Batch statements are held in the transactional context so you must use the <tt>@Transactional</tt> attribute to use the batch executor.
      </p>
      
      
<p>
        To enable transactions you need to activate the local transaction interceptor in beans.xml:
      </p>

      
<div class="source">
<pre>&lt;beans
   xmlns=&quot;http://java.sun.com/xml/ns/javaee&quot;
   xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
   xsi:schemaLocation=&quot;
      http://java.sun.com/xml/ns/javaee
      http://java.sun.com/xml/ns/javaee/beans_1_0.xsd&quot;&gt;
   &lt;interceptors&gt;
      &lt;class&gt;org.mybatis.cdi.LocalTransactionInterceptor&lt;/class&gt;
   &lt;/interceptors&gt;
&lt;/beans&gt;</pre></div>
         
      
<p>
        With this setting, MyBatis-CDI will start a transaction before entering the transactional method and will commit it if it
        ends with no exception or any exception that is not a <tt>RuntimeException</tt> or explicitly indicated in the 
        annotation property <tt>rollbackOn</tt> and the annotation property <tt>rollbackOnly</tt> is false. 
      </p>
      
      
<p>
        If a transactional method has calls to other nested transactional methods, inner method annotations will be ignored, transaction
        will begin before calling the outer method and will end after it ends.
      </p>

      
<p><span class="label important">NOTE</span>
        The local transaction interceptor uses a best-effort strategy. In case there are more than one <tt>SqlSessionFactory</tt>s
        it will try to commit or roll them all back one by one. <tt>LocalTransactionInterceptor</tt> cannot guarantee data consistency
        in this scenario, and it is only recommended when you are using at least one no-XA datasource. 
        Otherwise you should use the <tt>JtaTransactionInterceptor</tt> instead. See the following section for the details.
      </p>
  
    
<div class="section">
<h3>JTA Transactions<a name="JTA_Transactions"></a></h3>
      
<p>
        In case you are using more than one datasource you should use the JTA transaction interceptor by configuring the beans.xml file as follows:
      </p>
        
<div class="source">
<pre>&lt;beans
   xmlns=&quot;http://java.sun.com/xml/ns/javaee&quot;
   xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
   xsi:schemaLocation=&quot;
      http://java.sun.com/xml/ns/javaee
      http://java.sun.com/xml/ns/javaee/beans_1_0.xsd&quot;&gt;
   &lt;interceptors&gt;
      &lt;class&gt;org.mybatis.cdi.JtaTransactionInterceptor&lt;/class&gt;
   &lt;/interceptors&gt;
&lt;/beans&gt;</pre></div>
      
      
<p>
        And configure MyBatis to to use the MANAGED transaction manager in mybatis-config.xml file.
      </p>

      
<div class="source">
<pre>&lt;transactionManager type=&quot;MANAGED&quot; /&gt;</pre></div>
      
	</div>
	
    
<div class="section">
<h3>The @Transactional annotation<a name="The_Transactional_annotation"></a></h3>
        
<p>
            The <tt>@Transactional</tt> annotation supports the following parameters:</p>
            
<table border="0" class="table table-striped">
                <thead>
                    
<tr class="a">
                        
<th>Property</th>
                        
<th>Default</th>
                        
<th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    
<tr class="b">
                        
<td>executorType</td>
                        
<td>ExecutorType.SIMPLE</td>
                        
<td>The MyBatis executor type</td>
                    </tr>
                    
<tr class="a">
                        
<td>isolation</td>
                        
<td>Isolation.DEFAULT</td>
                        
<td>The transaction isolation level.  The default value will
                          cause MyBatis to use the default isolation level from the
                          data source.</td>
                    </tr>
                    
<tr class="b">
                        
<td>force</td>
                        
<td>false</td>
                        
<td>Flag to indicate that MyBatis has to force the
                        transaction <tt>commit()</tt></td>
                    </tr>
                    
<tr class="a">
                        
<td>rollbackOnly</td>
                        
<td>false</td>
                        
<td>If true, the transaction will never be committed, but rather the rollback will be forced.
                        That configuration is useful for testing purposes.</td>
                    </tr>
                    
<tr class="b">
                        
<td>rollbackOn</td>
                        
<td>not set</td>
                        
<td>Indicates which exception types must cause a transaction rollback. In addition
                        to the indicated exceptions, any <tt>RuntimeException</tt> will also cause a rollback.</td>
                    </tr>
                </tbody>
            </table>

      </div>
    </div>
  

                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                              <p >Copyright &copy;                    2010&#x2013;2014
                        <a href="http://www.mybatis.org/">MyBatis.org</a>.
            All rights reserved.      
                    
      </p>
        </div>

        
        
                </div>
    </footer>
        </body>
</html>
