<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 17 January 2014 
 | Rendered using Apache Maven Fluido Skin 1.3.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Frank Martinez" />
    <meta name="author" content="Eduardo Macarron" />
    <meta name="Date-Revision-yyyymmdd" content="20140117" />
    <meta http-equiv="Content-Language" content="en" />
    <title>MyBatis - 
    MyBatis-CDI | Injecting MyBatis beans</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.1.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.1.min.js"></script>

    
                  </head>
        <body class="topBarDisabled">
          
        
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>MyBatis CDI Extension</h2>
                </div>
                      </div>
        <div class="pull-right">                  <a href="http://www.mybatis.org/" id="bannerRight" title="MyBatis logo">
                                                                                        <img src="http://mybatis.github.io/images/mybatis-logo.png"  alt="MyBatis logo"/>
                </a>
      </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 17 January 2014
                      <span class="divider">|</span>
                   </li>
                  <li id="projectVersion">Version: 1.0-SNAPSHOT
                      </li>
                      
                
                    
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Reference Documentation</li>
                              
      <li>
  
                          <a href="index.html" title="Introduction">
          <i class="none"></i>
        Introduction</a>
            </li>
                
      <li>
  
                          <a href="getting-started.html" title="Getting Started">
          <i class="none"></i>
        Getting Started</a>
            </li>
                
      <li class="active">
  
            <a href="#"><i class="none"></i>Injecting beans</a>
          </li>
                
      <li>
  
                          <a href="transactions.html" title="Transactions">
          <i class="none"></i>
        Transactions</a>
            </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                                                                                                                        
      <li>
  
                          <a href="project-info.html" title="Project Information">
          <i class="icon-chevron-right"></i>
        Project Information</a>
                  </li>
                                                                                                                                                                                                                                    
      <li>
  
                          <a href="project-reports.html" title="Project Reports">
          <i class="icon-chevron-right"></i>
        Project Reports</a>
                  </li>
            </ul>
                
                    
                
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <!-- Copyright 2013 the original author or authors.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License. --><!-- version: $Id$ -->

  
    <div class="section">
<h2>Injecting MyBatis beans<a name="Injecting_MyBatis_beans"></a></h2>
    
      
<p>
        This section will take you through de details of the discovery and injection process.
      </p>
    
    
<div class="section">
<h3>Producing a Factory<a name="Producing_a_Factory"></a></h3>
      
<p>
        The <tt>SqlSessionFactory</tt> is the source of any MyBatis bean so first you need to create one (at least)
        and let the container know about it existence. To do so, create a bean with producer method, and make sure
        that you add the <tt>@ApplicationScoped</tt> annotation to it because we just want to have one instance
        of the factory for the whole application.
      </p>
      
      
<div class="source">
<pre>
public class SqlSessionFactoryProvider {

  @Produces
  @ApplicationScoped
  public SqlSessionFactory produceFactory() {
    String resource = &quot;org/mybatis/example/mybatis-config.xml&quot;;
    InputStream inputStream = Resources.getResourceAsStream(resource);
    SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream);
    return sqlSessionFactory;
  }

}</pre></div>      
      
      
<p><span class="label important">NOTE</span>
        If you forget the <tt>@ApplicationScoped</tt> the factory will be created on each injection, what implies 
        parsing and loading the whole MyBatis xml file set. You application will not fail but will startup terribly slow.
      </p>
      
    </div>
    
<div class="section">
<h3>Disvovering and injecting Mappers<a name="Disvovering_and_injecting_Mappers"></a></h3>

      
<p>
        During the initialization process MyBatis-CDI will look for injection points annotated with <tt>@Mapper</tt>
        like the following:
      </p>
      
        
<div class="source">
<pre>
public class FooServiceImpl implements FooService {

@Inject @Mapper private UserMapper userMapper;

public User doSomeStuff(String userId) {
  return this.userMapper.getUser(userId);
}</pre></div>

      
<p>
        Then it will get an instance (a proxy in fact) of that mapper from the <tt>SqlSessionFactory</tt> registered in 
        the CDI container and inject it into the bean. This proxy is not a normal mapper but a thread safe singleton 
        so you should not worry about its scope. 
      </p>

      
<p>
        Any configuration problem that may happen during the initialization process will make the module throw a 
        <tt>MyBatisCdiConfiurationException</tt>. Given that there is not much to configure, this
        exception is only thrown when the <tt>SqlSessionFactory</tt> cannot be found.
      </p>
      
    </div>
      
    
<div class="section">
<h3>Resolving ambiguities<a name="Resolving_ambiguities"></a></h3>

      
<p>
        In case you have more than one <tt>SqlSessionFactory</tt> you can choose the one you want to use
        in any injection point by using:
      </p>
      
      
<ul>
        
<li>One or more qualifiers</li>
        
<li>The name of the <tt>SqlSessionFactory</tt></li>
        
<li>Any paranoid combination of both</li>
      </ul>
      
      
<p>
        Follows below an snippet that shows a producer that creates two <tt>SqlSessionFactory</tt>s. A qualifier is used
        to differentiate them as you would do with any other CDI bean:
      </p>

        
<div class="source">
<pre>
@ApplicationScoped  
@Produces
@FooQualifier
public SqlSessionFactory createManagerFoo() throws IOException {
  ...
}
  
@ApplicationScoped
@Produces
@BarQualifier
public SqlSessionFactory createManagerBar() throws IOException {
  ...
}</pre></div>
    
      
<p>
        Now that there is no ambiguity you can select what factory you want to inject by adding the qualifier to it:
      </p>
    
        
<div class="source">
<pre>
@Inject @Mapper @FooQualifier private UserMapper userMapper;
</pre></div>    
      
      
<p>
        You can also give a name to your <tt>SqlSessionFactory</tt>:
      </p>

        
<div class="source">
<pre>
@ApplicationScoped
@Produces
@Named(&quot;fooManager&quot;)
public SqlSessionFactory createManager() throws IOException {
  ...
}</pre></div>
      
      
<p>
        And refer to it by its name in an injection point:
      </p>
      
        
<div class="source">
<pre>
@Inject @Mapper @Named(&quot;fooManager&quot;) private UserMapper userMapper;
</pre></div>    
      
    </div>
      
    
<div class="section">
<h3>Injecting an SqlSession<a name="Injecting_an_SqlSession"></a></h3>

	  
<p>You can inject a thread safe <tt>SqlSession</tt> by requesting its injection as follows:</p>
	  
        
<div class="source">
<pre>
@Inject private SqlSession sqlSession;
</pre></div>    

	  
<p>The factory selection criteria we saw for mappers apply also to <tt>SqlSession</tt> injection.</p>
	  
      
<p><span class="label important">NOTE</span>
        MyBatis-CDI controls the lifecycle of the injected <tt>SqlSession</tt> so you must not call any transactional method
        like <tt>commit()</tt> or <tt>rollback()</tt>, nor any lifecycle method like <tt>close()</tt>.
      </p>
	  
	</div>      
    </div>
  

                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                              <p >Copyright &copy;                    2010&#x2013;2014
                        <a href="http://www.mybatis.org/">MyBatis.org</a>.
            All rights reserved.      
                    
      </p>
        </div>

        
        
                </div>
    </footer>
        </body>
</html>
